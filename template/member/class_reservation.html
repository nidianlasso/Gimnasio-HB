{% extends "base.html" %}
{% block menu %}
    {% include "member/menu.html" %}
{% endblock %}
{% block content %}
<div class="reserva-container" style="max-width: 900px; margin: -350px auto; background: #fff; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;">
    <h1 style="text-align: center; color: #2c3e50; margin-bottom: 25px; font-weight: 700;">Clases disponibles</h1>

    <table style="width: 100%; border-collapse: collapse; text-align: center; font-size: 1rem;">
        <thead>
            <tr style="background-color: #27ae60; color: white;">
                <th style="padding: 14px; min-width: 150px;">Nombre</th>
                <th style="padding: 14px; min-width: 120px;">Fecha</th>
                <th style="padding: 14px; min-width: 100px;">Hora</th>
                <th style="padding: 14px; min-width: 120px;">Duración</th>
                <th style="padding: 14px; min-width: 100px;">Acción</th>
            </tr>
        </thead>
        <tbody>
            {% for clase in clases %}
            <tr style="border-bottom: 1px solid #ddd; transition: background-color 0.2s ease;">
                <td style="padding: 12px;">{{ clase[1] }}</td> 
                <td style="padding: 12px;">{{ clase[2] }}</td>
                <td style="padding: 12px;">{{ clase[3] }}</td> 
                <td style="padding: 12px;">{{ clase[4] }} Horas</td> 
                <td style="padding: 12px;">
                    <form method="post" action="/reservar-clase" class="form-reserva">
                        <input type="hidden" name="id_clase" value="{{ clase[0] }}">
                        <input type="hidden" name="fecha" value="{{ clase[2] }}">
                        <input type="hidden" name="hora" value="{{ clase[3] }}">
                        <button type="submit" style="background-color: #27ae60; color: white; border: none; padding: 8px 14px; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background-color 0.25s ease;">
                            Reservar <i class="fa-solid fa-calendar-check"></i>
                        </button>
                        <div class="mensaje-reserva" style="margin-top: 8px; font-weight: 600;"></div>

                    </form>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" style="padding: 20px; text-align: center; color: #888;">No hay clases disponibles</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
<script>
    document.addEventListener("DOMContentLoaded", function () {
    console.log("cargado correctamente");

    document.querySelectorAll(".form-reserva").forEach(function (form) {
        form.addEventListener("submit", function (e) {
            e.preventDefault();

            const formData = new FormData(form);
            const mensajeDiv = form.querySelector(".mensaje-reserva");
            const button = form.querySelector("button");

            button.disabled = true;
            button.textContent = "Reservando...";

            fetch("/reservar-clase", {
                method: "POST",
                body: formData,
                credentials: "include"
            })
            .then(response => response.json().then(data => ({ ok: response.ok, data })))
            .then(({ ok, data }) => {
                if (ok) {
                    mensajeDiv.textContent = data.mensaje;
                    mensajeDiv.style.color = "green";
                } else {
                    mensajeDiv.textContent = data.error || "Ocurrió un error";
                    mensajeDiv.style.color = "red";
                }
            })
            .catch(error => {
                console.error("Error:", error);
                mensajeDiv.textContent = "Error al conectar con el servidor.";
                mensajeDiv.style.color = "red";
            })
            .finally(() => {
                button.disabled = false;
                button.innerHTML = `Reservar <i class="fa-solid fa-calendar-check"></i>`;
            });
        });
    });
});
</script>